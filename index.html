<!DOCTYPE html>
<html lang="pt-BR">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Formul√°rio - Aditivo Contratual HubLocal</title>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/docxtemplater/3.42.3/docxtemplater.js"></script>
    <script src="https://unpkg.com/pizzip@3.1.4/dist/pizzip.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/FileSaver.js/2.0.5/FileSaver.min.js"></script>
    <script src="https://unpkg.com/pizzip@3.1.4/dist/pizzip-utils.js"></script>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }
        
        body {
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            min-height: 100vh;
            padding: 20px;
        }
        
        .container {
            max-width: 900px;
            margin: 0 auto;
            background: white;
            border-radius: 20px;
            box-shadow: 0 20px 60px rgba(0,0,0,0.3);
            overflow: hidden;
        }
        
        .header {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
            padding: 40px;
            text-align: center;
        }
        
        .header h1 {
            font-size: 28px;
            margin-bottom: 10px;
        }
        
        .header p {
            font-size: 14px;
            opacity: 0.9;
        }
        
        .form-content {
            padding: 40px;
        }
        
        .section {
            margin-bottom: 40px;
        }
        
        .section-title {
            font-size: 20px;
            color: #667eea;
            margin-bottom: 20px;
            padding-bottom: 10px;
            border-bottom: 2px solid #667eea;
            display: flex;
            align-items: center;
        }
        
        .section-title::before {
            content: "üìã";
            margin-right: 10px;
            font-size: 24px;
        }
        
        .form-row {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 20px;
            margin-bottom: 20px;
        }
        
        .form-row.full {
            grid-template-columns: 1fr;
        }
        
        .form-group {
            display: flex;
            flex-direction: column;
            position: relative;
        }
        
        label {
            font-weight: 600;
            margin-bottom: 8px;
            color: #333;
            font-size: 14px;
        }
        
        label span.required {
            color: #e74c3c;
            margin-left: 3px;
        }
        
        input, textarea, select {
            padding: 12px 15px;
            border: 2px solid #e0e0e0;
            border-radius: 8px;
            font-size: 14px;
            transition: all 0.3s;
            font-family: inherit;
        }
        
        input:focus, textarea:focus, select:focus {
            outline: none;
            border-color: #667eea;
            box-shadow: 0 0 0 3px rgba(102, 126, 234, 0.1);
        }
        
        input:disabled {
            background-color: #f5f5f5;
            cursor: not-allowed;
        }
        
        textarea {
            resize: vertical;
            min-height: 100px;
        }
        
        .loading {
            position: absolute;
            right: 15px;
            top: 42px;
            color: #667eea;
            font-size: 12px;
            animation: pulse 1.5s infinite;
        }
        
        @keyframes pulse {
            0%, 100% { opacity: 1; }
            50% { opacity: 0.5; }
        }
        
        .toggle-group {
            display: flex;
            gap: 10px;
            margin-bottom: 20px;
        }
        
        .toggle-btn {
            flex: 1;
            padding: 12px;
            border: 2px solid #e0e0e0;
            background: white;
            border-radius: 8px;
            cursor: pointer;
            transition: all 0.3s;
            font-weight: 600;
            text-align: center;
        }
        
        .toggle-btn:hover {
            border-color: #667eea;
        }
        
        .toggle-btn.active {
            background: #667eea;
            color: white;
            border-color: #667eea;
        }
        
        .calculation-box {
            background: #f8f9fa;
            border-radius: 12px;
            padding: 25px;
            margin-top: 30px;
            border: 2px dashed #667eea;
        }
        
        .calculation-box h3 {
            color: #667eea;
            margin-bottom: 20px;
            display: flex;
            align-items: center;
        }
        
        .calculation-box h3::before {
            content: "üßÆ";
            margin-right: 10px;
            font-size: 24px;
        }
        
        .calc-result {
            display: flex;
            justify-content: space-between;
            align-items: center;
            background: white;
            padding: 15px 20px;
            border-radius: 8px;
            margin-bottom: 15px;
            box-shadow: 0 2px 8px rgba(0,0,0,0.05);
        }
        
        .calc-result span:first-child {
            font-weight: 600;
            color: #555;
        }
        
        .calc-result span:last-child {
            font-size: 18px;
            font-weight: bold;
            color: #667eea;
        }
        
        .btn-container {
            display: flex;
            gap: 15px;
            margin-top: 40px;
        }
        
        .btn {
            flex: 1;
            padding: 15px 30px;
            border: none;
            border-radius: 10px;
            font-size: 16px;
            font-weight: 600;
            cursor: pointer;
            transition: all 0.3s;
            text-transform: uppercase;
            letter-spacing: 0.5px;
        }
        
        .btn-primary {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
            box-shadow: 0 4px 15px rgba(102, 126, 234, 0.4);
        }
        
        .btn-primary:hover:not(:disabled) {
            transform: translateY(-2px);
            box-shadow: 0 6px 20px rgba(102, 126, 234, 0.6);
        }
        
        .btn-secondary {
            background: #f8f9fa;
            color: #667eea;
            border: 2px solid #667eea;
        }
        
        .btn-secondary:hover {
            background: #667eea;
            color: white;
        }
        
        .btn-success {
            background: linear-gradient(135deg, #4caf50 0%, #45a049 100%);
            color: white;
            box-shadow: 0 4px 15px rgba(76, 175, 80, 0.4);
        }
        
        .btn-success:hover:not(:disabled) {
            transform: translateY(-2px);
            box-shadow: 0 6px 20px rgba(76, 175, 80, 0.6);
        }
        
        .btn:disabled {
            opacity: 0.5;
            cursor: not-allowed;
        }
        
        .info-box {
            background: #e3f2fd;
            border-left: 4px solid #2196f3;
            padding: 15px;
            border-radius: 8px;
            margin-bottom: 20px;
        }
        
        .info-box p {
            color: #1565c0;
            font-size: 14px;
            margin: 0;
        }
        
        .success-message {
            background: #e8f5e9;
            border-left: 4px solid #4caf50;
            padding: 12px 15px;
            border-radius: 8px;
            margin-top: 10px;
            color: #2e7d32;
            font-size: 13px;
            display: none;
        }
        
        .error-message {
            background: #ffebee;
            border-left: 4px solid #f44336;
            padding: 12px 15px;
            border-radius: 8px;
            margin-top: 10px;
            color: #c62828;
            font-size: 13px;
            display: none;
        }
        
        @media (max-width: 768px) {
            .form-row {
                grid-template-columns: 1fr;
            }
            
            .btn-container {
                flex-direction: column;
            }
        }
        
        .date-display {
            background: #e8f5e9;
            color: #2e7d32;
            padding: 10px 15px;
            border-radius: 8px;
            font-weight: bold;
            text-align: center;
            margin-bottom: 20px;
        }
        
        .file-upload-box {
            background: #fff3e0;
            border: 2px dashed #ff9800;
            border-radius: 12px;
            padding: 25px;
            text-align: center;
            margin-bottom: 30px;
            cursor: pointer;
            transition: all 0.3s;
        }
        
        .file-upload-box:hover {
            background: #ffe0b2;
            border-color: #f57c00;
        }
        
        .file-upload-box input {
            display: none;
        }
        
        .file-upload-box.has-file {
            background: #e8f5e9;
            border-color: #4caf50;
        }
        
        .file-name {
            color: #2e7d32;
            font-weight: bold;
            margin-top: 10px;
        }
    </style>
</head>
<body>
    <div class="container">
        <div class="header">
            <h1>üìÑ Aditivo Contratual - Hub Standard</h1>
            <p>HubLocal Servi√ßos de Informa√ß√µes na Internet</p>
        </div>
        
        <div class="form-content">
            <div class="date-display">
                üìÖ Data do Aditivo: <span id="dataHoje"></span>
            </div>
            
            <div class="info-box">
                <p>üí° <strong>Informa√ß√£o:</strong> Fa√ßa upload do documento Word template, preencha os dados e baixe o documento preenchido automaticamente!</p>
            </div>
            
            <!-- Upload do Template -->
            <div class="file-upload-box" id="uploadBox" onclick="document.getElementById('templateFile').click()">
                <input type="file" id="templateFile" accept=".docx" onchange="handleFileUpload(event)">
                <div id="uploadText">
                    <h3 style="color: #ff9800; margin-bottom: 10px;">üìÅ Fazer Upload do Template</h3>
                    <p style="color: #666; font-size: 14px;">Clique aqui ou arraste o arquivo .docx</p>
                    <p style="color: #999; font-size: 12px; margin-top: 5px;">Arquivo: Aditivo - Hub Standard.docx</p>
                </div>
                <div id="fileName" class="file-name" style="display: none;"></div>
            </div>
            
            <form id="aditivoForm">
                <!-- SE√á√ÉO 1: DADOS DA CONTRATANTE -->
                <div class="section">
                    <h2 class="section-title">Dados da Contratante</h2>
                    
                    <!-- TOGGLE CPF/CNPJ -->
                    <div class="toggle-group">
                        <button type="button" class="toggle-btn active" id="btnCNPJ" onclick="toggleDocumento('cnpj')">
                            üè¢ Pessoa Jur√≠dica (CNPJ)
                        </button>
                        <button type="button" class="toggle-btn" id="btnCPF" onclick="toggleDocumento('cpf')">
                            üë§ Pessoa F√≠sica (CPF)
                        </button>
                    </div>
                    
                    <!-- CAMPOS PJ -->
                    <div id="camposPJ">
                        <div class="form-row">
                            <div class="form-group">
                                <label for="nomeFantasia">Nome Fantasia <span class="required">*</span></label>
                                <input type="text" id="nomeFantasia" name="nomeFantasia">
                            </div>
                            <div class="form-group">
                                <label for="razaoSocial">Raz√£o Social <span class="required">*</span></label>
                                <input type="text" id="razaoSocial" name="razaoSocial">
                            </div>
                        </div>
                        
                        <div class="form-row">
                            <div class="form-group">
                                <label for="cnpj">CNPJ <span class="required">*</span></label>
                                <input type="text" id="cnpj" name="cnpj" placeholder="00.000.000/0000-00">
                            </div>
                            <div class="form-group">
                                <label for="email">E-mail <span class="required">*</span></label>
                                <input type="email" id="email" name="email" placeholder="contato@empresa.com.br">
                            </div>
                        </div>
                    </div>
                    
                    <!-- CAMPOS PF -->
                    <div id="camposPF" style="display: none;">
                        <div class="form-row">
                            <div class="form-group">
                                <label for="nomeCompleto">Nome Completo <span class="required">*</span></label>
                                <input type="text" id="nomeCompleto" name="nomeCompleto">
                            </div>
                            <div class="form-group">
                                <label for="cpf">CPF <span class="required">*</span></label>
                                <input type="text" id="cpf" name="cpf" placeholder="000.000.000-00">
                            </div>
                        </div>
                        
                        <div class="form-row">
                            <div class="form-group">
                                <label for="emailPF">E-mail <span class="required">*</span></label>
                                <input type="email" id="emailPF" name="emailPF" placeholder="seuemail@exemplo.com">
                            </div>
                        </div>
                    </div>
                    
                    <!-- ENDERE√áO (COMUM) -->
                    <div class="form-row">
                        <div class="form-group">
                            <label for="cep">CEP <span class="required">*</span></label>
                            <input type="text" id="cep" name="cep" placeholder="00000-000">
                            <span class="loading" id="loadingCep" style="display: none;">üîç Buscando...</span>
                            <div class="success-message" id="cepSuccess">‚úÖ Endere√ßo encontrado!</div>
                            <div class="error-message" id="cepError">‚ùå CEP n√£o encontrado. Verifique e tente novamente.</div>
                        </div>
                    </div>
                    
                    <div class="form-row full">
                        <div class="form-group">
                            <label for="endereco">Endere√ßo Completo <span class="required">*</span></label>
                            <input type="text" id="endereco" name="endereco" placeholder="Rua, Avenida...">
                        </div>
                    </div>
                    
                    <div class="form-row">
                        <div class="form-group">
                            <label for="numero">N√∫mero <span class="required">*</span></label>
                            <input type="text" id="numero" name="numero" placeholder="Ex: 123">
                        </div>
                        <div class="form-group">
                            <label for="complemento">Complemento</label>
                            <input type="text" id="complemento" name="complemento" placeholder="Sala, Apto, etc (opcional)">
                        </div>
                    </div>
                    
                    <div class="form-row">
                        <div class="form-group">
                            <label for="bairro">Bairro <span class="required">*</span></label>
                            <input type="text" id="bairro" name="bairro">
                        </div>
                        <div class="form-group">
                            <label for="cidade">Cidade <span class="required">*</span></label>
                            <input type="text" id="cidade" name="cidade">
                        </div>
                    </div>
                    
                    <div class="form-row">
                        <div class="form-group">
                            <label for="estado">Estado <span class="required">*</span></label>
                            <select id="estado" name="estado">
                                <option value="">Selecione...</option>
                                <option value="AC">Acre</option>
                                <option value="AL">Alagoas</option>
                                <option value="AP">Amap√°</option>
                                <option value="AM">Amazonas</option>
                                <option value="BA">Bahia</option>
                                <option value="CE">Cear√°</option>
                                <option value="DF">Distrito Federal</option>
                                <option value="ES">Esp√≠rito Santo</option>
                                <option value="GO">Goi√°s</option>
                                <option value="MA">Maranh√£o</option>
                                <option value="MT">Mato Grosso</option>
                                <option value="MS">Mato Grosso do Sul</option>
                                <option value="MG">Minas Gerais</option>
                                <option value="PA">Par√°</option>
                                <option value="PB">Para√≠ba</option>
                                <option value="PR">Paran√°</option>
                                <option value="PE">Pernambuco</option>
                                <option value="PI">Piau√≠</option>
                                <option value="RJ">Rio de Janeiro</option>
                                <option value="RN">Rio Grande do Norte</option>
                                <option value="RS">Rio Grande do Sul</option>
                                <option value="RO">Rond√¥nia</option>
                                <option value="RR">Roraima</option>
                                <option value="SC">Santa Catarina</option>
                                <option value="SP">S√£o Paulo</option>
                                <option value="SE">Sergipe</option>
                                <option value="TO">Tocantins</option>
                            </select>
                        </div>
                    </div>
                    
                    <div class="form-row">
                        <div class="form-group">
                            <label for="responsavel">Nome do Respons√°vel <span class="required">*</span></label>
                            <input type="text" id="responsavel" name="responsavel">
                        </div>
                        <div class="form-group">
                            <label for="funcao">Fun√ß√£o/Cargo <span class="required">*</span></label>
                            <input type="text" id="funcao" name="funcao" placeholder="Ex: Diretor, Gerente">
                        </div>
                    </div>
                    
                    <div class="form-row">
                        <div class="form-group">
                            <label for="telefone">Telefone Principal <span class="required">*</span></label>
                            <input type="tel" id="telefone" name="telefone" placeholder="(00) 00000-0000">
                        </div>
                    </div>
                </div>
                
                <!-- SE√á√ÉO 2: DADOS DO PLANO -->
                <div class="section">
                    <h2 class="section-title">Dados do Plano - Hub Standard</h2>
                    
                    <div class="form-row">
                        <div class="form-group">
                            <label for="totalLocais">Total de Locais/Unidades <span class="required">*</span></label>
                            <input type="number" id="totalLocais" name="totalLocais" min="1" placeholder="Ex: 10" required>
                        </div>
                        <div class="form-group">
                            <label for="valorUnidade">Valor por Unidade (R$) <span class="required">*</span></label>
                            <input type="text" id="valorUnidade" name="valorUnidade" placeholder="R$ 0,00" required>
                        </div>
                    </div>
                    
                    <div class="form-row full">
                        <div class="form-group">
                            <label for="observacao">Observa√ß√µes</label>
                            <textarea id="observacao" name="observacao" placeholder="Informa√ß√µes adicionais sobre o plano (opcional)"></textarea>
                        </div>
                    </div>
                    
                    <!-- C√ÅLCULO AUTOM√ÅTICO -->
                    <div class="calculation-box">
                        <h3>C√°lculo Autom√°tico</h3>
                        <div class="calc-result">
                            <span>Total de Locais:</span>
                            <span id="displayLocais">0</span>
                        </div>
                        <div class="calc-result">
                            <span>Valor por Unidade:</span>
                            <span id="displayValorUnitario">R$ 0,00</span>
                        </div>
                        <div class="calc-result" style="background: #e8f5e9; border: 2px solid #4caf50;">
                            <span style="color: #2e7d32;">üí∞ Valor Total Mensal:</span>
                            <span id="displayValorTotal" style="color: #2e7d32; font-size: 24px;">R$ 0,00</span>
                        </div>
                    </div>
                </div>
                
                <!-- BOT√ïES -->
                <div class="btn-container">
                    <button type="button" class="btn btn-secondary" onclick="limparFormulario()">üîÑ Limpar</button>
                    <button type="button" class="btn btn-success" onclick="gerarDocumento()" id="btnGerar" disabled>üì• Baixar Documento Preenchido</button>
                    <button type="submit" class="btn btn-primary">üìã Ver JSON</button>
                </div>
            </form>
        </div>
    </div>
    
    <script>
        let tipoPessoa = 'cnpj';
        let templateContent = null;
        
        // Formatar data de hoje
        function formatarDataHoje() {
            const hoje = new Date();
            const dia = String(hoje.getDate()).padStart(2, '0');
            const mes = String(hoje.getMonth() + 1).padStart(2, '0');
            const ano = hoje.getFullYear();
            return `${dia}/${mes}/${ano}`;
        }
        
        document.getElementById('dataHoje').textContent = formatarDataHoje();
        
        // Handle file upload
        function handleFileUpload(event) {
            const file = event.target.files[0];
            if (file && file.name.endsWith('.docx')) {
                const reader = new FileReader();
                reader.onload = function(e) {
                    templateContent = e.target.result;
                    document.getElementById('uploadBox').classList.add('has-file');
                    document.getElementById('uploadText').style.display = 'none';
                    document.getElementById('fileName').style.display = 'block';
                    document.getElementById('fileName').innerHTML = `‚úÖ Arquivo carregado: <strong>${file.name}</strong>`;
                    document.getElementById('btnGerar').disabled = false;
                };
                reader.readAsBinaryString(file);
            } else {
                alert('Por favor, selecione um arquivo .docx v√°lido!');
            }
        }
        
        // Fun√ß√£o para gerar documento
        function gerarDocumento() {
            if (!templateContent) {
                alert('Por favor, fa√ßa upload do template primeiro!');
                return;
            }
            
            const totalLocais = parseInt(document.getElementById('totalLocais').value) || 0;
            const valorUnidade = parseMoeda(document.getElementById('valorUnidade').value);
            const valorTotal = totalLocais * valorUnidade;
            
            const numero = document.getElementById('numero').value;
            const complemento = document.getElementById('complemento').value;
            const enderecoBase = document.getElementById('endereco').value;
            const enderecoCompleto = `${enderecoBase}, ${numero}${complemento ? ', ' + complemento : ''}`;
            
            let dados = {
                "data de hoje": formatarDataHoje(),
                "Nome Fantasia": "",
                "razaosocial": "",
                "CNPJ": "",
                "Endere√ßo": enderecoCompleto,
                "bairro": document.getElementById('bairro').value,
                "cidade": document.getElementById('cidade').value,
                "cep": document.getElementById('cep').value,
                "estado": document.getElementById('estado').value,
                "responsavel": document.getElementById('responsavel').value,
                "email": "",
                "fun√ßao": document.getElementById('funcao').value,
                "telefone": document.getElementById('telefone').value,
                "total de unidades": totalLocais.toString(),
                "observa√ß√£o": document.getElementById('observacao').value || "",
                "valor da unidade": formatarMoeda(valorUnidade),
                "valor total": formatarMoeda(valorTotal)
            };
            
            if (tipoPessoa === 'cnpj') {
                dados["Nome Fantasia"] = document.getElementById('nomeFantasia').value;
                dados["razaosocial"] = document.getElementById('razaoSocial').value;
                dados["CNPJ"] = document.getElementById('cnpj').value;
                dados["email"] = document.getElementById('email').value;
            } else {
                dados["Nome Fantasia"] = document.getElementById('nomeCompleto').value;
                dados["razaosocial"] = document.getElementById('nomeCompleto').value;
                dados["CNPJ"] = document.getElementById('cpf').value;
                dados["email"] = document.getElementById('emailPF').value;
            }
            
            try {
                // Carregar template
                const zip = new PizZip(templateContent);
                const doc = new window.docxtemplater(zip, {
                    paragraphLoop: true,
                    linebreaks: true,
                });
                
                // Preencher com dados
                doc.render(dados);
                
                // Gerar documento
                const blob = doc.getZip().generate({
                    type: 'blob',
                    mimeType: 'application/vnd.openxmlformats-officedocument.wordprocessingml.document',
                });
                
                // Baixar arquivo
                const nomeArquivo = `Aditivo_${dados["Nome Fantasia"].replace(/\s/g, '_')}_${formatarDataHoje().replace(/\//g, '-')}.docx`;
                saveAs(blob, nomeArquivo);
                
                alert('‚úÖ Documento gerado com sucesso!');
            } catch (error) {
                console.error('Erro ao gerar documento:', error);
                alert('‚ùå Erro ao gerar documento. Verifique se o template est√° correto e tente novamente.');
            }
        }
        
        // Toggle entre CPF e CNPJ
        function toggleDocumento(tipo) {
            tipoPessoa = tipo;
            const camposPJ = document.getElementById('camposPJ');
            const camposPF = document.getElementById('camposPF');
            const btnCNPJ = document.getElementById('btnCNPJ');
            const btnCPF = document.getElementById('btnCPF');
            
            if (tipo === 'cnpj') {
                camposPJ.style.display = 'block';
                camposPF.style.display = 'none';
                btnCNPJ.classList.add('active');
                btnCPF.classList.remove('active');
                
                document.getElementById('nomeFantasia').required = true;
                document.getElementById('razaoSocial').required = true;
                document.getElementById('cnpj').required = true;
                document.getElementById('email').required = true;
                
                document.getElementById('nomeCompleto').required = false;
                document.getElementById('cpf').required = false;
                document.getElementById('emailPF').required = false;
            } else {
                camposPJ.style.display = 'none';
                camposPF.style.display = 'block';
                btnCNPJ.classList.remove('active');
                btnCPF.classList.add('active');
                
                document.getElementById('nomeCompleto').required = true;
                document.getElementById('cpf').required = true;
                document.getElementById('emailPF').required = true;
                
                document.getElementById('nomeFantasia').required = false;
                document.getElementById('razaoSocial').required = false;
                document.getElementById('cnpj').required = false;
                document.getElementById('email').required = false;
            }
        }
        
        // M√°scara CPF
        document.getElementById('cpf').addEventListener('input', function(e) {
            let value = e.target.value.replace(/\D/g, '');
            if (value.length <= 11) {
                value = value.replace(/(\d{3})(\d)/, '$1.$2');
                value = value.replace(/(\d{3})(\d)/, '$1.$2');
                value = value.replace(/(\d{3})(\d{1,2})$/, '$1-$2');
            }
            e.target.value = value;
        });
        
        // M√°scara CNPJ
        document.getElementById('cnpj').addEventListener('input', function(e) {
            let value = e.target.value.replace(/\D/g, '');
            if (value.length <= 14) {
                value = value.replace(/^(\d{2})(\d)/, '$1.$2');
                value = value.replace(/^(\d{2})\.(\d{3})(\d)/, '$1.$2.$3');
                value = value.replace(/\.(\d{3})(\d)/, '.$1/$2');
                value = value.replace(/(\d{4})(\d)/, '$1-$2');
            }
            e.target.value = value;
        });
        
        // M√°scara CEP e busca autom√°tica
        document.getElementById('cep').addEventListener('input', function(e) {
            let value = e.target.value.replace(/\D/g, '');
            if (value.length <= 8) {
                value = value.replace(/^(\d{5})(\d)/, '$1-$2');
            }
            e.target.value = value;
            
            const cepNumeros = value.replace(/\D/g, '');
            if (cepNumeros.length === 8) {
                buscarCEP(cepNumeros);
            }
        });
        
        // Buscar CEP
        async function buscarCEP(cep) {
            const loadingCep = document.getElementById('loadingCep');
            const cepSuccess = document.getElementById('cepSuccess');
            const cepError = document.getElementById('cepError');
            
            loadingCep.style.display = 'block';
            cepSuccess.style.display = 'none';
            cepError.style.display = 'none';
            
            try {
                const response = await fetch(`https://viacep.com.br/ws/${cep}/json/`);
                const data = await response.json();
                
                if (data.erro) {
                    throw new Error('CEP n√£o encontrado');
                }
                
                document.getElementById('endereco').value = data.logradouro || '';
                document.getElementById('bairro').value = data.bairro || '';
                document.getElementById('cidade').value = data.localidade || '';
                document.getElementById('estado').value = data.uf || '';
                
                document.getElementById('numero').focus();
                
                loadingCep.style.display = 'none';
                cepSuccess.style.display = 'block';
                
                setTimeout(() => {
                    cepSuccess.style.display = 'none';
                }, 3000);
                
            } catch (error) {
                loadingCep.style.display = 'none';
                cepError.style.display = 'block';
                
                setTimeout(() => {
                    cepError.style.display = 'none';
                }, 5000);
            }
        }
        
        // M√°scara telefone
        document.getElementById('telefone').addEventListener('input', function(e) {
            let value = e.target.value.replace(/\D/g, '');
            if (value.length <= 11) {
                value = value.replace(/^(\d{2})(\d)/, '($1) $2');
                value = value.replace(/(\d{5})(\d)/, '$1-$2');
            }
            e.target.value = value;
        });
        
        // Formatar moeda
        function formatarMoeda(valor) {
            return valor.toLocaleString('pt-BR', { style: 'currency', currency: 'BRL' });
        }
        
        function parseMoeda(valor) {
            return parseFloat(valor.replace(/[^\d,]/g, '').replace(',', '.')) || 0;
        }
        
        document.getElementById('valorUnidade').addEventListener('input', function(e) {
            let value = e.target.value.replace(/\D/g, '');
            value = (parseInt(value) / 100).toFixed(2);
            e.target.value = formatarMoeda(parseFloat(value)).replace('R$', 'R$');
            calcularTotal();
        });
        
        document.getElementById('totalLocais').addEventListener('input', calcularTotal);
        
        function calcularTotal() {
            const totalLocais = parseInt(document.getElementById('totalLocais').value) || 0;
            const valorUnidade = parseMoeda(document.getElementById('valorUnidade').value);
            const valorTotal = totalLocais * valorUnidade;
            
            document.getElementById('displayLocais').textContent = totalLocais;
            document.getElementById('displayValorUnitario').textContent = formatarMoeda(valorUnidade);
            document.getElementById('displayValorTotal').textContent = formatarMoeda(valorTotal);
        }
        
        function limparFormulario() {
            if (confirm('Tem certeza que deseja limpar todos os campos?')) {
                document.getElementById('aditivoForm').reset();
                calcularTotal();
            }
        }
        
        // Ver JSON
        document.getElementById('aditivoForm').addEventListener('submit', function(e) {
            e.preventDefault();
            
            const totalLocais = parseInt(document.getElementById('totalLocais').value);
            const valorUnidade = parseMoeda(document.getElementById('valorUnidade').value);
            const valorTotal = totalLocais * valorUnidade;
            
            const numero = document.getElementById('numero').value;
            const complemento = document.getElementById('complemento').value;
            const enderecoBase = document.getElementById('endereco').value;
            const enderecoCompleto = `${enderecoBase}, ${numero}${complemento ? ', ' + complemento : ''}`;
            
            let dados = {
                "data_de_hoje": formatarDataHoje(),
                "tipo_pessoa": tipoPessoa.toUpperCase(),
            };
            
            if (tipoPessoa === 'cnpj') {
                dados["Nome Fantasia"] = document.getElementById('nomeFantasia').value;
                dados["razaosocial"] = document.getElementById('razaoSocial').value;
                dados["CNPJ"] = document.getElementById('cnpj').value;
                dados["email"] = document.getElementById('email').value;
            } else {
                dados["Nome Fantasia"] = document.getElementById('nomeCompleto').value;
                dados["razaosocial"] = document.getElementById('nomeCompleto').value;
                dados["CNPJ"] = document.getElementById('cpf').value;
                dados["email"] = document.getElementById('emailPF').value;
            }
            
            dados["Endere√ßo"] = enderecoCompleto;
            dados["bairro"] = document.getElementById('bairro').value;
            dados["cidade"] = document.getElementById('cidade').value;
            dados["cep"] = document.getElementById('cep').value;
            dados["estado"] = document.getElementById('estado').value;
            dados["responsavel"] = document.getElementById('responsavel').value;
            dados["fun√ßao"] = document.getElementById('funcao').value;
            dados["telefone"] = document.getElementById('telefone').value;
            dados["total de unidades"] = totalLocais.toString();
            dados["observa√ß√£o"] = document.getElementById('observacao').value || "N/A";
            dados["valor da unidade"] = formatarMoeda(valorUnidade);
            dados["valor total"] = formatarMoeda(valorTotal);
            
            const jsonOutput = JSON.stringify(dados, null, 2);
            
            const resultDiv = document.createElement('div');
            resultDiv.style.cssText = 'position:fixed;top:50%;left:50%;transform:translate(-50%,-50%);background:white;padding:30px;border-radius:15px;box-shadow:0 10px 40px rgba(0,0,0,0.3);z-index:1000;max-width:90%;max-height:80%;overflow:auto;';
            resultDiv.innerHTML = `
                <h2 style="color:#667eea;margin-bottom:20px;">üìã JSON Gerado</h2>
                <textarea readonly style="width:100%;height:400px;padding:15px;border:2px solid #667eea;border-radius:8px;font-family:monospace;font-size:12px;">${jsonOutput}</textarea>
                <div style="display:flex;gap:10px;margin-top:20px;">
                    <button onclick="navigator.clipboard.writeText(${JSON.stringify(jsonOutput)}).then(()=>alert('JSON copiado!'))" style="flex:1;padding:12px;background:#667eea;color:white;border:none;border-radius:8px;cursor:pointer;font-weight:bold;">üìã Copiar JSON</button>
                    <button onclick="this.parentElement.parentElement.remove();document.getElementById('overlay').remove();" style="flex:1;padding:12px;background:#e74c3c;color:white;border:none;border-radius:8px;cursor:pointer;font-weight:bold;">‚úñ Fechar</button>
                </div>
            `;
            
            const overlay = document.createElement('div');
            overlay.id = 'overlay';
            overlay.style.cssText = 'position:fixed;top:0;left:0;width:100%;height:100%;background:rgba(0,0,0,0.7);z-index:999;';
            overlay.onclick = function() {
                resultDiv.remove();
                overlay.remove();
            };
            
            document.body.appendChild(overlay);
            document.body.appendChild(resultDiv);
        });
    </script>
</body>
</html>